<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Toonix TV</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.min.css" rel="stylesheet"/>
  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #0f0f1b;
      color: white;
      margin: 0;
      padding: 0;
    }
    .logo {
      max-height: 60px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 1rem;
    }
    #videoContainer {
      display: none;
    }
    .channel-thumb {
      width: 50px;
      height: 50px;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="container text-center">
    <img src="https://cdn5.cdn-telegram.org/file/pftpARIH3rlNmSXjwODWJ64OjWO9gDGtpK2ivS3QbHIBhWsXITN05ZTMFeo7-81HA65WnMwigigUOdIXKSqQHvazIpvl-PX5z3mNtn68M9dybjH3fFBzVMTtwB4NLDh2Nxg9wt2zvPCk0LQbaUwOCc6RllJbeIwXOKBvepuMzU-zok2WHdP7UnIyJ_1tjskTZ8Zno1RfxetABHO_eXQXpdAtUZSuhlZWg5dsl38caBkPbCjmLp9SLsJzr4KPabmI5TzOQX0ft6N96SiPnGv9olzSq1AOOGjaH98xtM_NMrq-G0WoTWzdIR3Es2XZ_78_03e64aKD5T9ajLhwmAY5pg.jpg" alt="Toonix TV Logo" class="logo mx-auto mb-4 rounded-full"/>

    <h1 class="text-2xl font-bold mb-6">Toonix TV Player</h1>

    <input type="text" id="m3uUrl" placeholder="Paste M3U/M3U8 Playlist URL" class="w-full mb-3 p-2 rounded text-black" />
    <input type="file" id="fileUpload" class="w-full mb-3 p-2 rounded bg-gray-800"/>

    <button onclick="loadStream()" class="bg-blue-600 px-4 py-2 rounded mb-6">Load Playlist</button>

    <div id="playlistContainer" class="mb-6 space-y-2"></div>
    
    <div id="videoContainer">
      <video id="videoPlayer" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="360">
        <source src="" type="application/x-mpegURL"/>
      </video>
    </div>
  </div>

  <script>
    const m3uInput = document.getElementById('m3uUrl');
    const fileInput = document.getElementById('fileUpload');
    const playlistDiv = document.getElementById('playlistContainer');
    const videoContainer = document.getElementById('videoContainer');
    const player = videojs('videoPlayer');

    async function loadStream() {
      playlistDiv.innerHTML = '';
      const url = m3uInput.value.trim();
      const file = fileInput.files[0];

      if (url) {
        const res = await fetch(url);
        const text = await res.text();
        parseM3U(text);
      } else if (file) {
        const reader = new FileReader();
        reader.onload = e => parseM3U(e.target.result);
        reader.readAsText(file);
      }
    }

    function parseM3U(data) {
      const lines = data.split('\n');
      let currentTitle = '';
      let currentThumb = '';
      playlistDiv.innerHTML = '';

      lines.forEach((line, i) => {
        if (line.startsWith('#EXTINF')) {
          const titleMatch = line.match(/tvg-name="(.*?)"/) || line.match(/,(.*)$/);
          const thumbMatch = line.match(/tvg-logo="(.*?)"/);
          currentTitle = titleMatch ? titleMatch[1] : 'Unknown';
          currentThumb = thumbMatch ? thumbMatch[1] : '';
        } else if (line.startsWith('http')) {
          const videoURL = line.trim();
          const btn = document.createElement('button');
          btn.className = 'flex items-center space-x-2 w-full text-left p-2 bg-gray-800 hover:bg-gray-700 rounded';
          btn.innerHTML = `
            ${currentThumb ? `<img src="${currentThumb}" class="channel-thumb rounded-full"/>` : ''}
            <span>${currentTitle}</span>
          `;
          btn.onclick = () => loadVideo(videoURL);
          playlistDiv.appendChild(btn);
        }
      });
    }

    function loadVideo(url) {
      player.src({ src: url, type: 'application/x-mpegURL' });
      videoContainer.style.display = 'block';
      player.play();
    }
  </script>
</body>
</html>
