<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Toonix TV - M3U Playlist Player</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <style>
    body {
      font-family: sans-serif;
      background: #000;
      color: white;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    .container {
      max-width: 100%;
      padding: 1rem;
    }

    video {
      width: 100%;
      height: auto;
      border-radius: 1rem;
    }

    input, button {
      color: black;
    }

    .channel-thumb {
      width: 50px;
      height: 50px;
      object-fit: contain;
    }

    .channel-item:hover {
      background-color: #222;
    }
  </style>
</head>
<body>
  <div class="container mx-auto text-center">
    <h1 class="text-3xl font-bold mb-4">ðŸŽ¬ Toonix TV - Playlist Player</h1>
    
    <!-- Link Input Section -->
    <div id="linkInputBox" class="mb-4">
      <input type="text" id="m3uInput" placeholder="Paste M3U/M3U8 link..." class="p-2 rounded w-4/5 md:w-1/2" />
      <button onclick="loadPlaylist()" class="bg-purple-600 text-white px-4 py-2 rounded ml-2">Load</button>
    </div>

    <!-- Channel List -->
    <div id="channelList" class="text-left max-h-[300px] overflow-y-auto hidden mt-4 mb-6"></div>

    <!-- Video Player -->
    <div id="playerBox" class="hidden">
      <video id="videoPlayer" controls crossorigin="anonymous"></video>
    </div>
  </div>

  <script>
    async function loadPlaylist() {
      const url = document.getElementById('m3uInput').value.trim();
      if (!url.endsWith('.m3u') && !url.endsWith('.m3u8')) {
        alert('Please enter a valid M3U or M3U8 playlist URL');
        return;
      }

      try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split('\n');
        const channels = [];
        let current = {};

        lines.forEach(line => {
          if (line.startsWith('#EXTINF')) {
            const match = line.match(/tvg-logo="(.*?)".*,(.*)/);
            current = {
              logo: match ? match[1] : '',
              name: match ? match[2] : 'Unnamed Channel',
              url: ''
            };
          } else if (line.startsWith('http')) {
            current.url = line.trim();
            channels.push({ ...current });
          }
        });

        const listDiv = document.getElementById('channelList');
        listDiv.innerHTML = '';
        channels.forEach(ch => {
          const item = document.createElement('div');
          item.className = 'channel-item flex items-center p-2 cursor-pointer border-b border-gray-700';
          item.onclick = () => playChannel(ch.url);

          item.innerHTML = `
            <img src="${ch.logo}" class="channel-thumb mr-3" onerror="this.src='https://via.placeholder.com/50?text=TV'" />
            <span>${ch.name}</span>
          `;
          listDiv.appendChild(item);
        });

        listDiv.classList.remove('hidden');
        document.getElementById('playerBox').classList.remove('hidden');
      } catch (e) {
        alert('Error loading playlist.');
        console.error(e);
      }
    }

    function playChannel(url) {
      const player = document.getElementById('videoPlayer');
      player.src = url;
      player.load();
      player.play();
    }
  </script>
</body>
</html>
